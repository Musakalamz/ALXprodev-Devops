#!/usr/bin/env bash

# Parse data.json and print a human-readable summary using jq and awk only
set -euo pipefail

INPUT_FILE="${INPUT_FILE:-data.json}"

# Extract name, height (dm), weight (hg), and types, then format:
# Example: "Pikachu is of type Electric, weighs 6kg, and is 0.4m tall."
jq -r '[.name, .height, .weight, (.types | map(.type.name) | join(","))] | @tsv' "$INPUT_FILE" |
awk -F'\t' '
{
  name = $1
  h_dm = $2 + 0
  w_hg = $3 + 0
  types_raw = $4

  # Convert units
  h_m = h_dm / 10.0
  w_kg = w_hg / 10.0

  # Title-case name
  name = toupper(substr(name,1,1)) substr(name,2)

  # Process types and title-case each
  n = split(types_raw, types, ",")
  type_str = ""
  for (i = 1; i <= n; i++) {
    t = types[i]
    types[i] = toupper(substr(t,1,1)) substr(t,2)
    type_str = type_str ((i==1)?"":", ") types[i]
  }

  # Format weight: drop .0 if integer; height to one decimal
  w_out = (int(w_kg) == w_kg) ? sprintf("%d", w_kg) : sprintf("%.1f", w_kg)
  h_out = sprintf("%.1f", h_m)

  printf "%s is of type %s, weighs %skg, and is %sm tall.\n", name, type_str, w_out, h_out
}
'

